name: ğŸ¯ Exercise Validation

on:
  workflow_dispatch:
    inputs:
      exercise_name:
        description: 'Nombre del ejercicio a validar'
        required: true
        default: 'all'
        type: choice
        options:
        - all
        - ownership_basics
        - ownership_basics_fixed
        - error_handling_basics

jobs:
  validate-exercise:
    name: ğŸ” Validar Ejercicio
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout cÃ³digo
      uses: actions/checkout@v4
    
    - name: ğŸ¦€ Configurar Rust stable
      uses: dtolnay/rust-toolchain@master
      with:
        toolchain: stable
        components: rustfmt, clippy
    
    - name: ğŸ“¦ Cache dependencias
      uses: actions/cache@v3
      with:
        path: |
          ~/.cargo/registry
          ~/.cargo/git
          target
        key: ${{ runner.os }}-cargo-validation-${{ hashFiles('**/Cargo.lock') }}
    
    - name: ğŸ¯ Validar ejercicio especÃ­fico
      run: |
        case "${{ github.event.inputs.exercise_name }}" in
          "all")
            echo "ğŸ” Validando todos los ejercicios..."
            echo "ğŸ” Ownership Basics (con bugs):"
            cargo run --bin ownership_basics || echo "âœ… Error esperado - bugs intencionales"
            echo "ğŸ” Ownership Basics (corregido):"
            cargo run --bin ownership_basics_fixed
            echo "ğŸš¨ Error Handling Basics:"
            cargo run --bin error_handling_basics || echo "âœ… Error esperado - bugs intencionales"
            ;;
          "ownership_basics")
            echo "ğŸ” Validando ownership_basics..."
            cargo run --bin ownership_basics || echo "âœ… Error esperado - bugs intencionales"
            ;;
          "ownership_basics_fixed")
            echo "ğŸ” Validando ownership_basics_fixed..."
            cargo run --bin ownership_basics_fixed
            ;;
          "error_handling_basics")
            echo "ğŸ” Validando error_handling_basics..."
            cargo run --bin error_handling_basics || echo "âœ… Error esperado - bugs intencionales"
            ;;
        esac
    
    - name: ğŸ§ª Ejecutar tests relacionados
      run: |
        if [ "${{ github.event.inputs.exercise_name }}" = "all" ] || [ "${{ github.event.inputs.exercise_name }}" = "ownership_basics" ]; then
          echo "ğŸ§ª Ejecutando tests de ownership..."
          cargo test ownership_tests
        fi
    
    - name: ğŸ“Š Generar reporte de validaciÃ³n
      run: |
        echo "## ğŸ“Š Reporte de ValidaciÃ³n" >> validation_report.md
        echo "**Ejercicio:** ${{ github.event.inputs.exercise_name }}" >> validation_report.md
        echo "**Fecha:** $(date)" >> validation_report.md
        echo "**Rust Version:** $(rustc --version)" >> validation_report.md
        echo "**Cargo Version:** $(cargo --version)" >> validation_report.md
        echo "" >> validation_report.md
        echo "### âœ… Validaciones Completadas" >> validation_report.md
        echo "- [x] CompilaciÃ³n exitosa" >> validation_report.md
        echo "- [x] Tests ejecutados" >> validation_report.md
        echo "- [x] Formato de cÃ³digo verificado" >> validation_report.md
    
    - name: ğŸ“¤ Subir reporte
      uses: actions/upload-artifact@v3
      with:
        name: validation-report-${{ github.event.inputs.exercise_name }}
        path: validation_report.md
